"use strict";function flattenUnsubscriptionErrors(r){return r.reduce(function(r,t){return r.concat(t instanceof UnsubscriptionError_1.UnsubscriptionError?t.errors:t)},[])}var __extends=this&&this.__extends||function(r,t){function i(){this.constructor=r}for(var s in t)t.hasOwnProperty(s)&&(r[s]=t[s]);r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},isArray_1=require("./util/isArray"),isObject_1=require("./util/isObject"),isFunction_1=require("./util/isFunction"),tryCatch_1=require("./util/tryCatch"),errorObject_1=require("./util/errorObject"),UnsubscriptionError_1=require("./util/UnsubscriptionError"),Subscription=function(){function r(r){this.closed=!1,r&&(this._unsubscribe=r)}return r.prototype.unsubscribe=function(){var r,t=!1;if(!this.closed){this.closed=!0;var i=this,s=i._unsubscribe,n=i._subscriptions;if(this._subscriptions=null,isFunction_1.isFunction(s)){var e=tryCatch_1.tryCatch(s).call(this);e===errorObject_1.errorObject&&(t=!0,r=r||(errorObject_1.errorObject.e instanceof UnsubscriptionError_1.UnsubscriptionError?flattenUnsubscriptionErrors(errorObject_1.errorObject.e.errors):[errorObject_1.errorObject.e]))}if(isArray_1.isArray(n))for(var o=-1,c=n.length;++o<c;){var u=n[o];if(isObject_1.isObject(u)){var e=tryCatch_1.tryCatch(u.unsubscribe).call(u);if(e===errorObject_1.errorObject){t=!0,r=r||[];var b=errorObject_1.errorObject.e;b instanceof UnsubscriptionError_1.UnsubscriptionError?r=r.concat(flattenUnsubscriptionErrors(b.errors)):r.push(b)}}}if(t)throw new UnsubscriptionError_1.UnsubscriptionError(r)}},r.prototype.add=function(t){if(!t||t===r.EMPTY)return r.EMPTY;if(t===this)return this;var i=t;switch(typeof t){case"function":i=new r(t);case"object":if(i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var s=new ChildSubscription(i,this);return this._subscriptions=this._subscriptions||[],this._subscriptions.push(s),s},r.prototype.remove=function(t){if(null!=t&&t!==this&&t!==r.EMPTY){var i=this._subscriptions;if(i){var s=i.indexOf(t);s!==-1&&i.splice(s,1)}}},r.EMPTY=function(r){return r.closed=!0,r}(new r),r}();exports.Subscription=Subscription;var ChildSubscription=function(r){function t(t,i){r.call(this),this._innerSub=t,this._parent=i}return __extends(t,r),t.prototype._unsubscribe=function(){var r=this,t=r._innerSub,i=r._parent;i.remove(this),t.unsubscribe()},t}(Subscription);exports.ChildSubscription=ChildSubscription;