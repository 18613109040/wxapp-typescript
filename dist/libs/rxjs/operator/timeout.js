"use strict";function timeout(t,e){void 0===e&&(e=async_1.async);var i=isDate_1.isDate(t),r=i?+t-e.now():Math.abs(t);return this.lift(new TimeoutOperator(r,i,e,new TimeoutError_1.TimeoutError))}var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},async_1=require("../scheduler/async"),isDate_1=require("../util/isDate"),Subscriber_1=require("../Subscriber"),TimeoutError_1=require("../util/TimeoutError");exports.timeout=timeout;var TimeoutOperator=function(){function t(t,e,i,r){this.waitFor=t,this.absoluteTimeout=e,this.scheduler=i,this.errorInstance=r}return t.prototype.call=function(t,e){return e.subscribe(new TimeoutSubscriber(t,this.absoluteTimeout,this.waitFor,this.scheduler,this.errorInstance))},t}(),TimeoutSubscriber=function(t){function e(e,i,r,o,s){t.call(this,e),this.absoluteTimeout=i,this.waitFor=r,this.scheduler=o,this.errorInstance=s,this.index=0,this._previousIndex=0,this._hasCompleted=!1,this.scheduleTimeout()}return __extends(e,t),Object.defineProperty(e.prototype,"previousIndex",{get:function(){return this._previousIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasCompleted",{get:function(){return this._hasCompleted},enumerable:!0,configurable:!0}),e.dispatchTimeout=function(t){var e=t.subscriber,i=t.index;e.hasCompleted||e.previousIndex!==i||e.notifyTimeout()},e.prototype.scheduleTimeout=function(){var t=this.index;this.scheduler.schedule(e.dispatchTimeout,this.waitFor,{subscriber:this,index:t}),this.index++,this._previousIndex=t},e.prototype._next=function(t){this.destination.next(t),this.absoluteTimeout||this.scheduleTimeout()},e.prototype._error=function(t){this.destination.error(t),this._hasCompleted=!0},e.prototype._complete=function(){this.destination.complete(),this._hasCompleted=!0},e.prototype.notifyTimeout=function(){this.error(this.errorInstance)},e}(Subscriber_1.Subscriber);