"use strict";var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Subject_1=require("../Subject"),Observable_1=require("../Observable"),Subscriber_1=require("../Subscriber"),Subscription_1=require("../Subscription"),ConnectableObservable=function(e){function t(t,n){e.call(this),this.source=t,this.subjectFactory=n,this._refCount=0}return __extends(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(e=this._connection=new Subscription_1.Subscription,e.add(this.source.subscribe(new ConnectableSubscriber(this.getSubject(),this))),e.closed?(this._connection=null,e=Subscription_1.Subscription.EMPTY):this._connection=e),e},t.prototype.refCount=function(){return this.lift(new RefCountOperator(this))},t}(Observable_1.Observable);exports.ConnectableObservable=ConnectableObservable,exports.connectableObservableDescriptor={operator:{value:null},_refCount:{value:0,writable:!0},_subscribe:{value:ConnectableObservable.prototype._subscribe},getSubject:{value:ConnectableObservable.prototype.getSubject},connect:{value:ConnectableObservable.prototype.connect},refCount:{value:ConnectableObservable.prototype.refCount}};var ConnectableSubscriber=function(e){function t(t,n){e.call(this,t),this.connectable=n}return __extends(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(Subject_1.SubjectSubscriber),RefCountOperator=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var o=new RefCountSubscriber(e,n),r=t.subscribe(o);return o.closed||(o.connection=n.connect()),r},e}(),RefCountSubscriber=function(e){function t(t,n){e.call(this,t),this.connectable=n}return __extends(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(!e)return void(this.connection=null);this.connectable=null;var t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);var n=this.connection,o=e._connection;this.connection=null,!o||n&&o!==n||o.unsubscribe()},t}(Subscriber_1.Subscriber);