"use strict";var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},Subject_1=require("./Subject"),queue_1=require("./scheduler/queue"),Subscription_1=require("./Subscription"),observeOn_1=require("./operator/observeOn"),ObjectUnsubscribedError_1=require("./util/ObjectUnsubscribedError"),SubjectSubscription_1=require("./SubjectSubscription"),ReplaySubject=function(e){function t(t,r,i){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===r&&(r=Number.POSITIVE_INFINITY),e.call(this),this.scheduler=i,this._events=[],this._bufferSize=t<1?1:t,this._windowTime=r<1?1:r}return __extends(t,e),t.prototype.next=function(t){var r=this._getNow();this._events.push(new ReplayEvent(r,t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,r=this._trimBufferThenGetEvents(),i=this.scheduler;if(this.closed)throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError;this.hasError?t=Subscription_1.Subscription.EMPTY:this.isStopped?t=Subscription_1.Subscription.EMPTY:(this.observers.push(e),t=new SubjectSubscription_1.SubjectSubscription(this,e)),i&&e.add(e=new observeOn_1.ObserveOnSubscriber(e,i));for(var s=r.length,n=0;n<s&&!e.closed;n++)e.next(r[n].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||queue_1.queue).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,r=this._windowTime,i=this._events,s=i.length,n=0;n<s&&!(e-i[n].time<r);)n++;return s>t&&(n=Math.max(n,s-t)),n>0&&i.splice(0,n),i},t}(Subject_1.Subject);exports.ReplaySubject=ReplaySubject;var ReplayEvent=function(){function e(e,t){this.time=e,this.value=t}return e}();